image: Visual Studio 2017
configuration: Release

init:
- ps: >-
    if ($env:APPVEYOR_REPO_TAG -eq "true")

    {
      Update-AppveyorBuild -Version "$($env:APPVEYOR_REPO_TAG_NAME).$($env:APPVEYOR_BUILD_NUMBER)"
    }

    else

    {
      Update-AppveyorBuild -Version "0.0.0.$($env:APPVEYOR_BUILD_NUMBER)-$($env:APPVEYOR_REPO_COMMIT.substring(0,7))"
    }

# Patch true ensures that the assemblies version number gets set to the build version number
assembly_info:
  patch: true
  file: '**\AssemblyInfo.*'
  assembly_version: '{version}'
  assembly_file_version: '{version}'
  assembly_informational_version: '{version}'

nuget:
  project_feed: true

build_script:
  - ps: ./build.ps1

test: off

# build and deploy on tag push only
build:
  publish_nuget: true
  project: src/SwapTasks.sln
  verbosity: normal
  on:
    branch: master
    appveyor_repo_tag: true

deploy:
  release: ver.$(appveyor_build_version)
  description: '{version} released.'
  provider: GitHub
  auth_token:
    secure: VsdMi0ZqJ44K0iAhqjFz8rBe8hbhQAzv3DdpPw8XLpN+T4dZhWR2xdBUf1iHo1yX
  artifact: /.*\.nupkg/
  draft: false
  prerelease: false
  on:
    branch: master
    appveyor_repo_tag: true

deploy:
  - provider: NuGet
    api_key:
      secure: YUm99c5U4oxV7ee5vUuxzkcRV+8iFvKPTtorRBl0VRRqcMTmpck0wnKI6YeQUvJT
    artifact: /.*\.nupkg/
    on:
      branch: master
      appveyor_repo_tag: true
